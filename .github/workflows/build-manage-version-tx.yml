name: Build Protocol Version Transaction

on:
  workflow_dispatch:
    inputs:
      action_type:
        description: "Select action"
        type: choice
        options:
          - Enable Version
          - Disable Version
      target_version:
        description: "Protocol Version Number (e.g., 1, 2, etc.)"
        required: true
        type: string

jobs:
  build-version-tx:
    runs-on: ubuntu-latest
    env:
      # Multisig specific config (can be secrets or vars)
      MULTISIG_ADDRESS: ${{ vars.MULTISIG_ADDRESS }}
      MULTISIG_SIGNERS_BASE64_PUBKEYS: ${{ vars.MULTISIG_SIGNERS_BASE64_PUBKEYS }}
      MULTISIG_THRESHOLD: ${{ vars.MULTISIG_THRESHOLD }}
      MULTISIG_WEIGHTS: ${{ vars.MULTISIG_WEIGHTS }}

      # Dynamic Inputs
      PROTOCOL_VERSION: ${{ inputs.target_version }}
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install Dependencies
        run: npm ci

      - name: Build Enable Version Transaction
        if: ${{ inputs.action_type == 'Enable Version' }}
        run: npx tsx examples/treasury/versions/enable-version.ts

      - name: Build Disable Version Transaction
        if: ${{ inputs.action_type == 'Disable Version' }}
        run: npx tsx examples/treasury/versions/disable-version.ts
